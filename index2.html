<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <!-- Vylepšený viewport pro mobilní zařízení -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Výroba - Vylepšená aplikace</title>
  <style>
    /* Reset a základní styly */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
      line-height: 1.6;
    }
    header {
      background-color: #007BFF;
      color: white;
      padding: 15px;
      text-align: center;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
    }
    /* Možnost hamburger menu (v případě rozšíření) */
    .menu-toggle {
      display: none;
      cursor: pointer;
      font-size: 24px;
      position: absolute;
      left: 15px;
      top: 15px;
    }
    @media (max-width: 600px) {
      .menu-toggle {
        display: block;
      }
    }
    .container {
      max-width: 600px;
      margin: 80px auto;
      padding: 15px;
    }
    /* Pohledy (views) s efektem přechodu */
    .view {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    .view.active {
      display: block;
      opacity: 1;
    }
    /* Vylepšené tlačítka */
    .button, .back-button {
      background-color: #007BFF;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px 0;
      transition: background-color 0.2s ease-in-out;
    }
    .button:hover, .back-button:hover {
      background-color: #0056b3;
    }
    /* Styl formulářových prvků */
    input[type="text"],
    input[type="password"],
    input[type="number"],
    input[type="date"],
    textarea,
    select {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
      font-size: 16px;
    }
    tr:hover {
      background-color: #f1f1f1;
      cursor: pointer;
    }
    .deleteBtn {
      background-color: #FF4136;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 5px 8px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .deleteBtn:hover {
      background-color: #cc312b;
    }
    .radio-group label {
      margin-right: 10px;
      font-size: 16px;
    }
    .detail-actions {
      position: absolute;
      top: 20px;
      right: 15px;
    }
    .detail-actions button {
      margin-left: 5px;
      font-size: 14px;
      padding: 5px 10px;
    }
    /* Stavové popisky pro postup práce */
    .status-complete { color: green; font-weight: bold; }
    .status-partial { color: orange; font-weight: bold; }
    .status-notstarted { color: red; font-weight: bold; }
    /* Responzivní úpravy pro mobil */
    @media (max-width: 600px) {
      .container {
        padding: 10px;
        margin-top: 70px;
      }
      .button, .back-button {
        font-size: 14px;
        padding: 8px 12px;
      }
      table, th, td {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <span class="menu-toggle">&#9776;</span>
    <h1>Výroba</h1>
  </header>
  <div class="container">
    <!-- Přihlášení -->
    <section id="loginView" class="view active">
      <h2>Přihlášení</h2>
      <label for="loginUsername">Uživatelské jméno:</label>
      <input type="text" id="loginUsername" placeholder="Zadejte uživatelské jméno">
      <label for="loginPassword">Heslo:</label>
      <input type="password" id="loginPassword" placeholder="Zadejte heslo">
      <button class="button" id="loginBtn">Přihlásit se</button>
      <p id="loginError" style="color:red;"></p>
    </section>

    <!-- Seznam zakázek -->
    <section id="mainView" class="view">
      <h2>Seznam zakázek</h2>
      <button class="button" id="showAddOrderBtn">Přidat zakázku</button>
      <table>
        <thead>
          <tr>
            <th>Zakázka č.</th>
            <th>Firma</th>
            <th>Výrobek</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="orderList"></tbody>
      </table>
      <button class="button" id="logoutBtn">Odhlásit se</button>
    </section>

    <!-- Detail zakázky – zobrazení -->
    <section id="orderDetailView" class="view" style="position:relative;">
      <div class="detail-actions">
        <button class="button" id="editOrderBtn">Upravit</button>
        <button class="button" style="background-color:#FF4136;" id="deleteOrderBtn">Smazat</button>
      </div>
      <button class="back-button" id="backToListBtn">← Zpět na seznam</button>
      <h2>Zakázka: <span id="orderNumberDisplay"></span></h2>
      <p>Firma: <span id="orderCustomerDisplay"></span></p>
      <p>Výrobek: <span id="orderProductDisplay"></span></p>
      <p>Počet kusů: <span id="orderQuantityDisplay"></span></p>
      <p>Číslo objednávky: <span id="orderOrderNumberDisplay"></span></p>
      <p>Datum objednávky: <span id="orderOrderDateDisplay"></span></p>
      <p>Datum dodání: <span id="orderDeliveryDateDisplay"></span></p>
      <p>Vedoucí zakázky: <span id="orderManagerDisplay"></span></p>
      <p>Sklad: <span id="orderStockDisplay"></span></p>
      <p>Poznámky: <span id="orderNotesDisplay"></span></p>
      <p>Vybraný automat: <span id="orderAssignedMachineDisplay"></span></p>
      <div id="savedMachineDisplay"></div>
      <div id="progressSummary"></div>
      <hr>
      <h3>Sekce</h3>
      <button class="button" id="showMachineDetailBtn">Automaty</button>
      <button class="button" id="showAoiControlBtn">AOI kontrola</button>
      <button class="button" id="showManualAssemblyBtn">Ruční osazování</button>
      <button class="button" id="showHandSolderingBtn">Ruční pájení</button>
      <button class="button" id="showSelectiveSolderingBtn">Selektivní pájení</button>
      <button class="button" id="showPostSolderingControlBtn">Kontrola po pájení</button>
      <button class="button" id="showWaveViewBtn">Vlna</button>
    </section>

    <!-- Detail zakázky – editace -->
    <section id="orderEditView" class="view">
      <button class="back-button" id="cancelEditBtn">← Zrušit úpravy</button>
      <h2>Upravit zakázku</h2>
      <p>Zakázka: <span id="orderNumberEditDisplay"></span></p>
      <label for="orderCustomerEdit">Firma:</label>
      <input type="text" id="orderCustomerEdit">
      <label for="orderProductEdit">Výrobek:</label>
      <input type="text" id="orderProductEdit">
      <label for="orderQuantityEdit">Počet kusů:</label>
      <input type="number" id="orderQuantityEdit">
      <label for="orderOrderNumberEdit">Číslo objednávky:</label>
      <input type="text" id="orderOrderNumberEdit">
      <label for="orderOrderDateEdit">Datum objednávky:</label>
      <input type="date" id="orderOrderDateEdit">
      <label for="orderDeliveryDateEdit">Datum dodání:</label>
      <input type="date" id="orderDeliveryDateEdit">
      <label for="orderManagerEdit">Vedoucí zakázky:</label>
      <select id="orderManagerEdit">
        <option value="">-- vyberte vedoucího --</option>
        <option value="Petr Zamouřil">Petr Zamouřil</option>
        <option value="Jakub Opa">Jakub Opa</option>
        <option value="Ondřej Polák">Ondřej Polák</option>
        <option value="Petr Novák">Petr Novák</option>
      </select>
      <label><input type="checkbox" id="orderStockEdit"> Materiál připraven</label>
      <label for="orderNotesEdit">Poznámky:</label>
      <textarea id="orderNotesEdit" placeholder="Poznámky k zakázce..."></textarea>
      <button class="button" id="saveOrderBtn">Uložit zakázku</button>
    </section>

    <!-- Přidat zakázku -->
    <section id="orderAddView" class="view">
      <button class="back-button" id="backToListFromAddBtn">← Zpět na seznam</button>
      <h2>Přidat zakázku</h2>
      <label for="addCustomer">Firma:</label>
      <input type="text" id="addCustomer">
      <label for="addProduct">Výrobek:</label>
      <input type="text" id="addProduct">
      <label for="addQuantity">Počet kusů:</label>
      <input type="number" id="addQuantity">
      <label for="addTechnology">Technologie:</label>
      <select id="addTechnology">
        <option value="Olovo">Olovo</option>
        <option value="Bezolovo">Bezolovo</option>
      </select>
      <label for="addOrderNumber">Číslo zakázky:</label>
      <input type="number" id="addOrderNumber" placeholder="např. 250000">
      <label for="addOrderID">Číslo objednávky:</label>
      <input type="text" id="addOrderID">
      <label for="addOrderDate">Datum objednávky:</label>
      <input type="date" id="addOrderDate">
      <label for="addDeliveryDate">Datum dodání:</label>
      <input type="date" id="addDeliveryDate">
      <label for="addManager">Vedoucí zakázky:</label>
      <select id="addManager">
        <option value="">-- vyberte vedoucího --</option>
        <option value="Petr Zamouřil">Petr Zamouřil</option>
        <option value="Jakub Opa">Jakub Opa</option>
        <option value="Ondřej Polák">Ondřej Polák</option>
        <option value="Petr Novák">Petr Novák</option>
      </select>
      <label for="addAssignedMachine">Přiřadit automat:</label>
      <select id="addAssignedMachine">
        <option value="">-- Vyberte automat --</option>
        <option value="Alfa">Alfa</option>
        <option value="Beta">Beta</option>
        <option value="Gama">Gama</option>
        <option value="Delta">Delta</option>
      </select>
      <label for="addNotes">Poznámky:</label>
      <textarea id="addNotes" placeholder="Poznámky k zakázce..."></textarea>
      <button class="button" id="addOrderBtn">Přidat zakázku</button>
    </section>

    <!-- Sekce Automaty -->
    <section id="machineDetailView" class="view">
      <button class="back-button" id="backToDetailFromMachineBtn">← Zpět na detail zakázky</button>
      <h2>Automaty</h2>
      <p>Vyberte automat:</p>
      <div class="radio-group" id="machineRadioGroup">
        <label><input type="radio" name="machineRadio" value="Alfa"> Alfa</label>
        <label><input type="radio" name="machineRadio" value="Beta"> Beta</label>
        <label><input type="radio" name="machineRadio" value="Gama"> Gama</label>
        <label><input type="radio" name="machineRadio" value="Delta"> Delta</label>
      </div>
      <div id="machineDetails" style="display:none; margin-top:10px; border: 1px solid #ccc; padding:10px;">
        <h4 id="selectedMachineTitle"></h4>
        <label for="machineDescription">Popis automatu:</label>
        <textarea id="machineDescription" placeholder="Zadejte popis automatu..."></textarea>
        <div>
          <label><input type="checkbox" id="togglePreparation"> Příprava</label><br>
          <label><input type="checkbox" id="toggleAssemblyFirst"> Osazení první strana</label><br>
          <label><input type="checkbox" id="toggleAssemblySecond"> Osazení druhá strana</label><br>
          <label><input type="checkbox" id="toggleMachineDone"> Hotovo</label>
        </div>
        <label for="machineCount">Počet osazených desek:</label>
        <input type="number" id="machineCount">
        <button class="button" id="saveMachineDetailsBtn">Uložit automat</button>
      </div>
    </section>

    <!-- Sekce AOI kontrola -->
    <section id="aoiControlView" class="view">
      <button class="back-button" id="backToDetailFromAoiBtn">← Zpět na detail zakázky</button>
      <label><input type="checkbox" id="toggleAoiDone"> Kontrola dokončena</label>
      <label><input type="checkbox" id="toggleAoiFirst"> Kontrola první strana</label>
      <label><input type="checkbox" id="toggleAoiSecond"> Kontrola druhá strana</label>
      <label for="aoiQuantity">Počet kusů (přidat/aktualizovat):</label>
      <input type="number" id="aoiQuantity">
      <button class="button" id="saveAoiControlBtn">Uložit AOI kontrolu</button>
    </section>

    <!-- Sekce Ruční osazování -->
    <section id="manualAssemblyView" class="view">
      <button class="back-button" id="backToDetailFromManualBtn">← Zpět na detail zakázky</button>
      <label for="manualNotes">Poznámky:</label>
      <textarea id="manualNotes" placeholder="Poznámky..."></textarea>
      <label for="manualCount">Počet kusů (přidat/aktualizovat):</label>
      <input type="number" id="manualCount" placeholder="Počet osazených desek">
      <label><input type="checkbox" id="toggleManualDone"> Hotovo</label>
      <button class="button" id="saveManualAssemblyBtn">Uložit Ruční osazování</button>
    </section>

    <!-- Sekce Ruční pájení -->
    <section id="handSolderingView" class="view">
      <button class="back-button" id="backToDetailFromHandSolderBtn">← Zpět na detail zakázky</button>
      <label for="handSolderNotes">Poznámky:</label>
      <textarea id="handSolderNotes" placeholder="Poznámky..."></textarea>
      <label for="handSolderCount">Počet kusů (přidat/aktualizovat):</label>
      <input type="number" id="handSolderCount" placeholder="Počet pájených desek">
      <label><input type="checkbox" id="toggleHandSolderDone"> Hotovo</label>
      <button class="button" id="saveHandSolderingBtn">Uložit Ruční pájení</button>
    </section>

    <!-- Sekce Selektivní pájení -->
    <section id="selectiveSolderingView" class="view">
      <button class="back-button" id="backToDetailFromSelectiveBtn">← Zpět na detail zakázky</button>
      <label for="solderingNotes">Poznámky:</label>
      <textarea id="solderingNotes" placeholder="Poznámky k výrobě..."></textarea>
      <div>
        <label><input type="checkbox" id="toggleFirstSide"> První strana</label>
        <label><input type="checkbox" id="toggleSecondSide"> Druhá strana</label>
      </div>
      <label for="solderingQuantity">Počet kusů (přidat/aktualizovat):</label>
      <input type="number" id="solderingQuantity">
      <label><input type="checkbox" id="toggleSolderingDone"> Hotovo</label>
      <button class="button" id="saveSelectiveSolderingBtn">Uložit Selektivní pájení</button>
    </section>

    <!-- Sekce Kontrola po pájení -->
    <section id="postSolderingControlView" class="view">
      <button class="back-button" id="backToDetailFromPostSolderBtn">← Zpět na detail zakázky</button>
      <label for="postInspectedCount">Počet zkontrolovaných desek (přidat/aktualizovat):</label>
      <input type="number" id="postInspectedCount" placeholder="Počet zkontrolovaných desek">
      <label for="postNotes">Poznámky:</label>
      <textarea id="postNotes" placeholder="Poznámky k výrobě..."></textarea>
      <button class="button" id="savePostSolderingControlBtn">Uložit Kontrolu po pájení</button>
    </section>

    <!-- Sekce Vlna -->
    <section id="waveView" class="view">
      <button class="back-button" id="backToDetailFromWaveBtn">← Zpět na detail zakázky</button>
      <label for="waveNotes">Poznámky:</label>
      <textarea id="waveNotes" placeholder="Poznámky k výrobě..."></textarea>
      <label for="waveQuantity">Počet kusů (přidat/aktualizovat):</label>
      <input type="number" id="waveQuantity">
      <label><input type="checkbox" id="toggleWaveDone"> Hotovo</label>
      <button class="button" id="saveWaveBtn">Uložit Vlna</button>
    </section>
  </div>

  <script>
    /****************************************************************
     * Vylepšení a organizace JavaScript kódu:
     * - Použití event listenerů místo inline atributů.
     * - Automatické přizpůsobení výšky textareas pro lepší zadávání poznámek.
     * - Jednotné funkce pro zobrazení/skrytí jednotlivých "view".
     * - Ukládání a načítání zakázek z localStorage.
     ****************************************************************/

    // Auto-resize pro všechny textareas (vylepšení zadávání poznámek)
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    });

    // Globální proměnné a načtení zakázek
    const views = document.querySelectorAll('.view');
    let currentOrder = null;
    let orders = [
      {
        id: 1,
        orderNumber: 250000,
        customer: "Firma A",
        product: "Produkt A",
        quantity: 333,
        orderID: "A001",
        orderDate: "2024-12-01",
        deliveryDate: "2024-12-10",
        manager: "Petr Novák",
        stockReady: false,
        notes: "",
        status: "Příprava",
        assignedMachine: "",
        machineDetail: { description: "", preparation: false, assemblyFirst: false, assemblySecond: false, machineDone: false },
        progress: { machineCount: 0, aoiCount: 0, manualCount: 0, handSolderCount: 0, solderingCount: 0, postCount: 0, waveCount: 0 }
      },
      {
        id: 2,
        orderNumber: 250001,
        customer: "Firma B",
        product: "Produkt B",
        quantity: 200,
        orderID: "B002",
        orderDate: "2024-12-02",
        deliveryDate: "2024-12-12",
        manager: "Jana Dvořáková",
        stockReady: true,
        notes: "",
        status: "Osazeno první strana",
        assignedMachine: "",
        machineDetail: { description: "", preparation: false, assemblyFirst: false, assemblySecond: false, machineDone: false },
        progress: { machineCount: 0, aoiCount: 0, manualCount: 0, handSolderCount: 0, solderingCount: 0, postCount: 0, waveCount: 0 }
      }
    ];

    // Ukládání a načítání zakázek do/z localStorage
    function saveOrders() {
      localStorage.setItem('orders', JSON.stringify(orders));
    }
    function loadOrders() {
      const data = localStorage.getItem('orders');
      if (data) orders = JSON.parse(data);
    }
    loadOrders();

    // Funkce pro zobrazení konkrétního "view"
    function showView(viewId) {
      views.forEach(v => v.classList.remove('active'));
      document.getElementById(viewId).classList.add('active');
      if(viewId === 'orderDetailView') updateProgressSummary();
    }

    // Přihlášení
    document.getElementById('loginBtn').addEventListener('click', () => {
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      if(username === 'admin' && password === 'heslo') {
        showMainView();
      } else {
        document.getElementById('loginError').textContent = "Nesprávné přihlašovací údaje.";
      }
    });
    document.getElementById('logoutBtn').addEventListener('click', () => showView('loginView'));

    // Zobrazení hlavního seznamu zakázek
    function showMainView() {
      populateOrderList();
      showView('mainView');
    }
    function populateOrderList() {
      const tbody = document.getElementById('orderList');
      tbody.innerHTML = '';
      orders.sort((a, b) => a.orderNumber - b.orderNumber);
      orders.forEach(order => {
        const tr = document.createElement('tr');
        tr.addEventListener('click', () => showOrderDetail(order.id));
        tr.innerHTML = `<td>${order.orderNumber.toLocaleString('cs-CZ')}</td>
                        <td>${order.customer}</td>
                        <td>${order.product}</td>
                        <td><button class="deleteBtn" data-id="${order.id}">Smazat</button></td>`;
        tbody.appendChild(tr);
      });
    }
    // Delegace smazání zakázky přes tlačítko v tabulce
    document.getElementById('orderList').addEventListener('click', function(e) {
      if(e.target.classList.contains('deleteBtn')) {
        e.stopPropagation();
        const orderId = parseInt(e.target.getAttribute('data-id'));
        deleteOrderById(orderId);
      }
    });

    function showOrderDetail(orderId) {
      currentOrder = orders.find(o => o.id === orderId);
      if(currentOrder) {
        document.getElementById('orderNumberDisplay').textContent = currentOrder.orderNumber.toLocaleString('cs-CZ');
        document.getElementById('orderCustomerDisplay').textContent = currentOrder.customer;
        document.getElementById('orderProductDisplay').textContent = currentOrder.product;
        document.getElementById('orderQuantityDisplay').textContent = currentOrder.quantity;
        document.getElementById('orderOrderNumberDisplay').textContent = currentOrder.orderID;
        document.getElementById('orderOrderDateDisplay').textContent = currentOrder.orderDate;
        document.getElementById('orderDeliveryDateDisplay').textContent = currentOrder.deliveryDate;
        document.getElementById('orderManagerDisplay').textContent = currentOrder.manager;
        document.getElementById('orderStockDisplay').textContent = currentOrder.stockReady ? "Materiál připraven" : "Materiál není připraven";
        document.getElementById('orderNotesDisplay').textContent = currentOrder.notes;
        document.getElementById('orderAssignedMachineDisplay').textContent = currentOrder.assignedMachine || "-";

        const savedDiv = document.getElementById('savedMachineDisplay');
        const totalM = currentOrder.progress.machineCount || 0;
        if(currentOrder.assignedMachine) {
          const md = currentOrder.machineDetail || {};
          savedDiv.innerHTML = `<h3>Automat: ${currentOrder.assignedMachine}</h3>
                                <p>Popis: ${md.description || ""}</p>
                                <p>Příprava: ${md.preparation ? "Hotovo" : "Nezahájeno"}</p>
                                <p>Osazení první strana: ${md.assemblyFirst ? "Hotovo" : "Nezahájeno"}</p>
                                <p>Osazení druhá strana: ${md.assemblySecond ? "Hotovo" : "Nezahájeno"}</p>
                                <p>Hotovo: ${md.machineDone ? "Hotovo" : "Nezahájeno"}</p>
                                <p>Počet osazených desek (celkem): ${totalM}</p>`;
        } else {
          savedDiv.innerHTML = "";
        }
        showView('orderDetailView');
      }
    }

    function updateProgressSummary() {
      if(!currentOrder) return;
      const p = currentOrder.progress;
      const total = currentOrder.quantity;
      function getStatus(count) {
        if(count >= total && total > 0) return `<span class="status-complete">Hotovo (${count}/${total})</span>`;
        if(count > 0) return `<span class="status-partial">Částečně (${count}/${total})</span>`;
        return `<span class="status-notstarted">Nezahájeno</span>`;
      }
      const summaryHTML = `<h3>Postup práce:</h3>
        <ul>
          <li>Automat: ${getStatus(p.machineCount)}</li>
          <li>AOI kontrola: ${getStatus(p.aoiCount)}</li>
          <li>Ruční osazování: ${getStatus(p.manualCount)}</li>
          <li>Ruční pájení: ${getStatus(p.handSolderCount)}</li>
          <li>Selektivní pájení: ${getStatus(p.solderingCount)}</li>
          <li>Kontrola po pájení: ${getStatus(p.postCount)}</li>
          <li>Vlna: ${getStatus(p.waveCount)}</li>
        </ul>`;
      document.getElementById('progressSummary').innerHTML = summaryHTML;
    }

    // Editace a smazání zakázky
    document.getElementById('editOrderBtn').addEventListener('click', () => {
      if(currentOrder) {
        document.getElementById('orderNumberEditDisplay').textContent = currentOrder.orderNumber.toLocaleString('cs-CZ');
        document.getElementById('orderCustomerEdit').value = currentOrder.customer;
        document.getElementById('orderProductEdit').value = currentOrder.product;
        document.getElementById('orderQuantityEdit').value = currentOrder.quantity;
        document.getElementById('orderOrderNumberEdit').value = currentOrder.orderID;
        document.getElementById('orderOrderDateEdit').value = currentOrder.orderDate;
        document.getElementById('orderDeliveryDateEdit').value = currentOrder.deliveryDate;
        document.getElementById('orderManagerEdit').value = currentOrder.manager || "";
        document.getElementById('orderStockEdit').checked = currentOrder.stockReady;
        document.getElementById('orderNotesEdit').value = currentOrder.notes;
        showView('orderEditView');
      }
    });
    document.getElementById('saveOrderBtn').addEventListener('click', () => {
      if(currentOrder) {
        currentOrder.customer = document.getElementById('orderCustomerEdit').value;
        currentOrder.product = document.getElementById('orderProductEdit').value;
        currentOrder.quantity = parseInt(document.getElementById('orderQuantityEdit').value) || 0;
        currentOrder.orderID = document.getElementById('orderOrderNumberEdit').value;
        currentOrder.orderDate = document.getElementById('orderOrderDateEdit').value;
        currentOrder.deliveryDate = document.getElementById('orderDeliveryDateEdit').value;
        currentOrder.manager = document.getElementById('orderManagerEdit').value;
        currentOrder.stockReady = document.getElementById('orderStockEdit').checked;
        currentOrder.notes = document.getElementById('orderNotesEdit').value;
        saveOrders();
        alert("Zakázka byla uložena!");
        showOrderDetail(currentOrder.id);
      }
    });
    document.getElementById('cancelEditBtn').addEventListener('click', () => {
      if(currentOrder) showOrderDetail(currentOrder.id);
    });
    document.getElementById('deleteOrderBtn').addEventListener('click', () => {
      if(currentOrder && confirm("Opravdu chcete smazat tuto zakázku?")) {
        deleteOrderById(currentOrder.id);
      }
    });
    function deleteOrderById(id) {
      orders = orders.filter(o => o.id !== id);
      saveOrders();
      alert("Zakázka byla smazána.");
      showMainView();
    }

    // Přidání nové zakázky
    document.getElementById('showAddOrderBtn').addEventListener('click', () => {
      document.getElementById('addCustomer').value = "";
      document.getElementById('addProduct').value = "";
      document.getElementById('addQuantity').value = "";
      document.getElementById('addTechnology').value = "Olovo";
      document.getElementById('addOrderNumber').value = "";
      document.getElementById('addOrderID').value = "";
      document.getElementById('addOrderDate').value = "";
      document.getElementById('addDeliveryDate').value = "";
      document.getElementById('addManager').value = "";
      document.getElementById('addAssignedMachine').value = "";
      document.getElementById('addNotes').value = "";
      showView('orderAddView');
    });
    document.getElementById('backToListFromAddBtn').addEventListener('click', () => showMainView());
    document.getElementById('addOrderBtn').addEventListener('click', () => {
      const newId = orders.length ? Math.max(...orders.map(o => o.id)) + 1 : 1;
      const newOrder = {
        id: newId,
        orderNumber: parseInt(document.getElementById('addOrderNumber').value) || 0,
        customer: document.getElementById('addCustomer').value,
        product: document.getElementById('addProduct').value,
        quantity: parseInt(document.getElementById('addQuantity').value) || 0,
        orderID: document.getElementById('addOrderID').value,
        orderDate: document.getElementById('addOrderDate').value,
        deliveryDate: document.getElementById('addDeliveryDate').value,
        manager: document.getElementById('addManager').value,
        stockReady: false,
        notes: document.getElementById('addNotes').value,
        status: "Nová zakázka",
        assignedMachine: document.getElementById('addAssignedMachine').value || "",
        machineDetail: { description: "", preparation: false, assemblyFirst: false, assemblySecond: false, machineDone: false },
        progress: { machineCount: 0, aoiCount: 0, manualCount: 0, handSolderCount: 0, solderingCount: 0, postCount: 0, waveCount: 0 }
      };
      orders.push(newOrder);
      saveOrders();
      alert("Zakázka byla přidána.");
      showMainView();
    });

    // Návrat k detailu zakázky ze seznamu
    document.getElementById('backToListBtn').addEventListener('click', showMainView);

    // Sekce Automaty
    document.getElementById('showMachineDetailBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const radios = document.querySelectorAll('input[name="machineRadio"]');
      radios.forEach(r => {
        r.checked = (r.value === currentOrder.assignedMachine);
      });
      document.getElementById('machineDescription').value = currentOrder.machineDetail.description || "";
      document.getElementById('togglePreparation').checked = currentOrder.machineDetail.preparation;
      document.getElementById('toggleAssemblyFirst').checked = currentOrder.machineDetail.assemblyFirst;
      document.getElementById('toggleAssemblySecond').checked = currentOrder.machineDetail.assemblySecond;
      document.getElementById('toggleMachineDone').checked = currentOrder.machineDetail.machineDone;
      document.getElementById('machineCount').value = "";
      document.getElementById('machineDetails').style.display = "none";
      showView('machineDetailView');
    });
    document.getElementById('machineRadioGroup').addEventListener('change', function(e) {
      if(e.target.name === "machineRadio") {
        document.getElementById('selectedMachineTitle').textContent = "Automat " + e.target.value;
        document.getElementById('machineDetails').style.display = "block";
      }
    });
    document.getElementById('saveMachineDetailsBtn').addEventListener('click', () => {
      const radios = document.getElementsByName("machineRadio");
      let selectedMachine = "";
      radios.forEach(r => { if(r.checked) selectedMachine = r.value; });
      if(!selectedMachine) {
        alert("Prosím, vyberte automat.");
        return;
      }
      currentOrder.machineDetail.description = document.getElementById('machineDescription').value;
      currentOrder.machineDetail.preparation = document.getElementById('togglePreparation').checked;
      currentOrder.machineDetail.assemblyFirst = document.getElementById('toggleAssemblyFirst').checked;
      currentOrder.machineDetail.assemblySecond = document.getElementById('toggleAssemblySecond').checked;
      currentOrder.machineDetail.machineDone = document.getElementById('toggleMachineDone').checked;
      const count = parseInt(document.getElementById('machineCount').value) || 0;
      currentOrder.progress.machineCount = Math.min((currentOrder.progress.machineCount || 0) + count, currentOrder.quantity);
      currentOrder.assignedMachine = selectedMachine;
      saveOrders();
      alert("Detaily automatu " + selectedMachine + " byly uloženy.");
      document.getElementById('machineCount').value = "";
      showOrderDetail(currentOrder.id);
    });

    // Sekce AOI kontrola
    document.getElementById('showAoiControlBtn').addEventListener('click', () => showView('aoiControlView'));
    document.getElementById('saveAoiControlBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('aoiQuantity').value) || 0;
      currentOrder.progress.aoiCount = Math.min((currentOrder.progress.aoiCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("AOI kontrola uložena, přidáno " + added + " ks.");
      document.getElementById('aoiQuantity').value = "";
      ['toggleAoiDone', 'toggleAoiFirst', 'toggleAoiSecond'].forEach(id => document.getElementById(id).checked = false);
      showOrderDetail(currentOrder.id);
    });

    // Sekce Ruční osazování
    document.getElementById('showManualAssemblyBtn').addEventListener('click', () => showView('manualAssemblyView'));
    document.getElementById('saveManualAssemblyBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('manualCount').value) || 0;
      currentOrder.progress.manualCount = Math.min((currentOrder.progress.manualCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("Ruční osazování uloženo, přidáno " + added + " ks.");
      document.getElementById('manualCount').value = "";
      document.getElementById('manualNotes').value = "";
      document.getElementById('toggleManualDone').checked = false;
      showOrderDetail(currentOrder.id);
    });

    // Sekce Ruční pájení
    document.getElementById('showHandSolderingBtn').addEventListener('click', () => showView('handSolderingView'));
    document.getElementById('saveHandSolderingBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('handSolderCount').value) || 0;
      currentOrder.progress.handSolderCount = Math.min((currentOrder.progress.handSolderCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("Ruční pájení uloženo, přidáno " + added + " ks.");
      document.getElementById('handSolderCount').value = "";
      document.getElementById('handSolderNotes').value = "";
      document.getElementById('toggleHandSolderDone').checked = false;
      showOrderDetail(currentOrder.id);
    });

    // Sekce Selektivní pájení
    document.getElementById('showSelectiveSolderingBtn').addEventListener('click', () => showView('selectiveSolderingView'));
    document.getElementById('saveSelectiveSolderingBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('solderingQuantity').value) || 0;
      currentOrder.progress.solderingCount = Math.min((currentOrder.progress.solderingCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("Selektivní pájení uloženo, přidáno " + added + " ks.");
      document.getElementById('solderingQuantity').value = "";
      document.getElementById('solderingNotes').value = "";
      document.getElementById('toggleSolderingDone').checked = false;
      document.getElementById('toggleFirstSide').checked = false;
      document.getElementById('toggleSecondSide').checked = false;
      showOrderDetail(currentOrder.id);
    });

    // Sekce Kontrola po pájení
    document.getElementById('showPostSolderingControlBtn').addEventListener('click', () => showView('postSolderingControlView'));
    document.getElementById('savePostSolderingControlBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('postInspectedCount').value) || 0;
      currentOrder.progress.postCount = Math.min((currentOrder.progress.postCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("Kontrola po pájení uložena, přidáno " + added + " ks.");
      document.getElementById('postInspectedCount').value = "";
      document.getElementById('postNotes').value = "";
      showOrderDetail(currentOrder.id);
    });

    // Sekce Vlna
    document.getElementById('showWaveViewBtn').addEventListener('click', () => showView('waveView'));
    document.getElementById('saveWaveBtn').addEventListener('click', () => {
      if(!currentOrder) return;
      const added = parseInt(document.getElementById('waveQuantity').value) || 0;
      currentOrder.progress.waveCount = Math.min((currentOrder.progress.waveCount || 0) + added, currentOrder.quantity);
      saveOrders();
      alert("Vlna uložena, přidáno " + added + " ks.");
      document.getElementById('waveQuantity').value = "";
      document.getElementById('waveNotes').value = "";
      document.getElementById('toggleWaveDone').checked = false;
      showOrderDetail(currentOrder.id);
    });
  </script>
</body>
</html>
